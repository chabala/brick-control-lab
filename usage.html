<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!-- Generated by Apache Maven Doxia Site Renderer 1.8.1 from src/site/markdown/usage.md.vm at 2023-08-27 -->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <title>brick-control-lab &#x2013; Usage</title>
    <style type="text/css" media="all">
      @import url("./css/maven-base.css");
      @import url("./css/maven-theme.css");
      @import url("./css/site.css");
    </style>
    <link rel="stylesheet" href="./css/print.css" type="text/css" media="print" />
    <meta http-equiv="Content-Language" content="en" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
    
    <!-- Google Analytics -->
    <script type="text/javascript">

      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-256611-4']);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();

    </script>
  </head>
  <body class="composite">
    <div id="banner">
<a href="./" id="bannerLeft">brick-control-lab
</a>
      <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="breadcrumbs">
      <div class="xleft">
        <span id="publishDate">Last Published: 2023-08-27</span>
          &nbsp;| <span id="projectVersion">Version: 0.2.1</span>
      </div>
      <div class="xright"><a href="./" title="brick-control-lab">brick-control-lab</a> |
<a href="https://github.com/chabala/brick-control-lab" class="externalLink" title="GitHub repo">GitHub repo</a>      </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
    <div id="leftColumn">
      <div id="navcolumn">
       <h5>Overview</h5>
    <ul>
     <li class="none"><a href="index.html" title="About">About</a></li>
     <li class="none"><strong>Usage</strong></li>
     <li class="none"><a href="features.html" title="Features">Features</a></li>
    </ul>
       <h5>Documentation</h5>
    <ul>
     <li class="none"><a href="building.html" title="Building">Building</a></li>
     <li class="none"><a href="serial-sniffing.html" title="Serial Sniffing">Serial Sniffing</a></li>
     <li class="none"><a href="hardware-configuration.html" title="Hardware Configuration">Hardware Configuration</a></li>
     <li class="none"><a href="references.html" title="References">References</a></li>
    </ul>
       <h5>Project Documentation</h5>
    <ul>
     <li class="collapsed"><a href="project-info.html" title="Project Information">Project Information</a></li>
     <li class="collapsed"><a href="project-reports.html" title="Project Reports">Project Reports</a></li>
    </ul>
      <a href="http://maven.apache.org/" title="Built by Maven" class="poweredBy">
        <img class="poweredBy" alt="Built by Maven" src="./images/logos/maven-feather.png" />
      </a>
      </div>
    </div>
    <div id="bodyColumn">
      <div id="contentBox">
<div class="section">
<h2><a name="Usage"></a>Usage</h2>
<div class="section">
<h3><a name="Declare_dependency_on_the_library"></a>Declare dependency on the library</h3>
<p>brick-control-lab uses <a class="externalLink" href="https://search.maven.org/search?q=g:org.chabala.brick%20AND%20a:brick-control-lab&amp;core=gav">Maven Central</a> for distribution. To use brick-control-lab with Maven, add the following to your pom:</p>
<script src="https://cdn.jsdelivr.net/gh/google/code-prettify@master/loader/run_prettify.js"></script>

<div>
<pre class="prettyprint lang-xml source">
&lt;dependency&gt;
  &lt;groupId&gt;org.chabala.brick&lt;/groupId&gt;
  &lt;artifactId&gt;brick-control-lab&lt;/artifactId&gt;
  &lt;version&gt;0.2.1&lt;/version&gt;
&lt;/dependency&gt;
</pre></div>

<p>For syntax for other dependency management systems, see <a href="dependency-info.html">Dependency Information</a>.</p></div>
<div class="section">
<h3><a name="Working_with_ControlLab"></a>Working with ControlLab</h3>
<p>The entrypoint to using the library is the <tt>ControlLab</tt> interface. Obtain an instance via <tt>newControlLab()</tt>:</p>

<div>
<pre class="prettyprint lang-java source">
ControlLab controlLab = ControlLab.newControlLab();
</pre></div>

<p>Next the control lab needs to be bound to a serial port. This could be a hard coded or user defined value, but there is also a method that queries the underlying serial library to find what ports are available, based on some heuristics for port names. This might be useful for populating a configuration dialog. Here we&#x2019;ll take the first port returned and bind it to the control lab:</p>

<div>
<pre class="prettyprint lang-java source">
List&lt;String&gt; availablePorts = controlLab.getAvailablePorts();
controlLab.open(availablePorts.get(0));
</pre></div>

<p>There is a fluent style for controlling output ports (motors, lights, etc).</p>

<div>
<pre class="prettyprint lang-java source">
controlLab.getOutput(OutputId.A).turnOn();
controlLab.getOutput(OutputId.B).setPowerLevel(PowerLevel.P4).turnOn();
controlLab.getOutput(OutputId.C).setDirection(Direction.LEFT).turnOn();
</pre></div>

<p>The reference for an output can be retained and reused.</p>

<div>
<pre class="prettyprint lang-java source">
Output outputA = controlLab.getOutput(OutputId.A);
outputA.turnOn();
outputA.setPowerLevel(PowerLevel.P4)
outputA.reverseDirection();
outputA.turnOff();
</pre></div>

<p>Outputs can also be operated on as a group.</p>

<div>
<pre class="prettyprint lang-java source">
controlLab.getOutput(EnumSet.range(OutputId.A, OutputId.D)).setPowerLevel(PowerLevel.P4).turnOn();
controlLab.getOutput(OutputId.ALL).turnOff();
</pre></div>

<p>There are also non-fluent style methods that are closer to the underlying protocol used by the interface hardware.</p>

<div>
<pre class="prettyprint lang-java source">
controlLab.turnOutputOn(OutputId.ALL);
controlLab.setOutputDirection(Direction.LEFT, EnumSet.of(OutputId.E, OutputId.F));
</pre></div>

<p>Input handling from the control lab is based on callback listeners. The stop button can be considered a special type of input, as it supports pressed and released events.</p>

<div>
<pre class="prettyprint lang-java source">
controlLab.getStopButton().addListener(new StopButtonListener() {
    @Override
    public void stopButtonPressed(StopButtonEvent stopButtonEvent) {
        System.out.println(&quot;Stopped&quot;);
    }
    
    @Override
    public void stopButtonReleased(StopButtonEvent stopButtonEvent) {
        System.out.println(&quot;Running&quot;);
    }
});
</pre></div>

<p>The release event has a default no-op implementation, so if one is only interested in the inital stop event, lambdas can be used instead:</p>

<div>
<pre class="prettyprint lang-java source">
controlLab.getStopButton().addListener(stopButtonEvent -&gt; System.out.println(&quot;Stopped&quot;));
</pre></div>

<p>Listeners can be added to other inputs, either as the raw values returned by the hardware, or specific sensor subclasses that attempt to interpret the values. Improvements are needed in this area, but the touch sensor is well understood:</p>

<div>
<pre class="prettyprint lang-java source">
controlLab.getInput(InputId.I1).addListener(new TouchSensorListener() {
    @Override
    public void touchSensorEventReceived(TouchSensorEvent sensorEvent) {
        System.out.println(sensorEvent.getValue().touchStatus());
    }
});
</pre></div>

<p>Every operation that involves the serial connection can potentially throw <tt>IOException</tt>, so one will need to catch those exceptions and determine how to recover. Once opened, the control lab needs to be closed in order to release the serial port and associated resources. Recommended usage is with try-finally or try-with-resources blocks to ensure proper closure.</p>

<div>
<pre class="prettyprint lang-java source">
ControlLab controlLab = ControlLab.newControlLab();
List&lt;String&gt; availablePorts = controlLab.getAvailablePorts();
try {
    controlLab.open(availablePorts.get(0));
    controlLab.getOutput(OutputId.A).setPowerLevel(PowerLevel.P4).turnOn();
} catch (IOException e) {
    e.printStackTrace();
} finally {
    try {
        controlLab.close();
    } catch (IOException e) {
        e.printStackTrace();
    }
}
</pre></div>

<p>Refer to the <a href="apidocs/index.html">javadoc</a> for further details on using <tt>ControlLab</tt> and related classes.</p>
<p>For more usage examples, examine the integration tests <a href="xref-test/org/chabala/brick/controllab/ControlLabIT.html">ControlLabIT</a> and <a href="xref-test/org/chabala/brick/controllab/MultipleControlLabIT.html">MultipleControlLabIT</a>.</p></div></div>
      </div>
    </div>
    <div class="clear">
      <hr/>
    </div>
    <div id="footer">
      <div class="xright">
        Copyright &#169;      2016&#x2013;2023.All rights reserved.      </div>
      <div class="clear">
        <hr/>
      </div>
    </div>
  </body>
</html>